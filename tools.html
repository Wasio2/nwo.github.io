<!DOCTYPE html>
<html>
<head>
  <title>API Testing Tools</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .tool-section {
      border: 1px solid #ccc;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      background-color: #f9f9f9;
    }
    input, select {
      padding: 8px;
      margin-right: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>API Testing Tools</h1>
    <p>Use this page to test the complex POST endpoints of your Railway backend.</p>

    <!-- 1. FIND LAWYER REQUEST -->
    <div class="tool-section">
      <h2>1. Find Lawyer Request</h2>
      <p>Creates a new case request in the database.</p>
      <select id="case-type">
        <option value="traffic">Traffic</option>
        <option value="arrest">Arrest</option>
        <option value="court">Court</option>
      </select>
      <button onclick="requestLawyer()">Find Lawyer</button>
    </div>

    <!-- 2. COMPLETE CASE / WALLET PAYOUT -->
    <div class="tool-section">
      <h2>2. Complete Case & Payout</h2>
      <p>Marks a case as complete and processes payment to the lawyer (ID 1).</p>
      <input type="number" id="case-id" placeholder="Case ID (e.g., 1)">
      <input type="number" id="amount" placeholder="Amount Paid (e.g., 100)">
      <input type="number" id="lawyer-id" value="1" placeholder="Lawyer ID">
      <button onclick="completeCase()">Complete Case</button>
    </div>

    <!-- 3. RATE LAWYER -->
    <div class="tool-section">
      <h2>3. Rate Lawyer</h2>
      <p>Submits a rating and updates the lawyer's average rating.</p>
      <input type="number" id="rate-lawyer-id" value="1" placeholder="Lawyer ID">
      <select id="stars">
        <option value="5">5 Stars</option>
        <option value="4">4 Stars</option>
        <option value="3">3 Stars</option>
        <option value="2">2 Stars</option>
        <option value="1">1 Star</option>
      </select>
      <button onclick="rateLawyer()">Rate Lawyer</button>
    </div>
  </div>

  <script>
    const BACKEND_URL = "https://nwo-backend-production.up.railway.app";
    const USER_ID = 1; // Hardcoded test user ID

    // 1. Request Lawyer
    async function requestLawyer( ){
      const caseType = document.getElementById("case-type").value;
      
      const res = await fetch(`${BACKEND_URL}/api/request-lawyer`, {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({
          user_id: USER_ID,
          case_type: caseType,
          lat: 34.05, // Example coordinates
          lng: -118.24
        })
      });
      const data = await res.json();
      alert("Request Created. ID: " + data.request_id || data.error);
    }

    // 2. Complete Case
    async function completeCase(){
      const caseId = document.getElementById("case-id").value;
      const amount = document.getElementById("amount").value;
      const lawyerId = document.getElementById("lawyer-id").value;

      const res = await fetch(`${BACKEND_URL}/api/case/complete`, {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({
          case_id: caseId,
          amount: parseFloat(amount),
          lawyer_id: parseInt(lawyerId)
        })
      });
      const data = await res.json();
      alert(data.message || data.error);
    }

    // 3. Rate Lawyer
    async function rateLawyer(){
      const lawyerId = document.getElementById("rate-lawyer-id").value;
      const stars = document.getElementById("stars").value;

      const res = await fetch(`${BACKEND_URL}/api/rate-lawyer`, {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({
          user_id: USER_ID,
          lawyer_id: parseInt(lawyerId),
          stars: parseInt(stars),
          comment: "Test rating from tools page."
        })
      });
      const data = await res.json();
      alert(data.message || data.error);
    }
  </script>
</body>
</html>
